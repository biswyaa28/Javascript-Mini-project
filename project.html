<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Noâ€‘Code Form Builder</title>

        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                font-family: Arial, sans-serif;
                padding: 20px;
                background: #f5f5f5;
            }

            .container {
                display: flex;
                gap: 20px;
                max-width: 1200px;
                margin: auto;
            }

            .sidebar {
                width: 200px;
                background: #fff;
                padding: 15px;
                border-radius: 8px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            }
            .sidebar h3 {
                margin-bottom: 10px;
            }
            .element {
                padding: 10px;
                margin: 8px 0;
                background: #eee;
                border-radius: 4px;
                cursor: grab;
                text-align: center;
            }

            .canvas {
                flex: 1;
                background: #fff;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            }
            #formCanvas {
                min-height: 400px;
                border: 2px dashed #ccc;
                padding: 15px;
            }
            #formCanvas.drag-over {
                border-color: #007bff;
            }

            .form-element {
                margin: 10px 0;
                padding: 15px;
                border: 1px solid #ddd;
                border-radius: 4px;
                background: #fff;
            }
            .form-element.selected {
                border: 4px solid #007bff;
                background: #f0f8ff;
            }

            .element-header {
                display: flex;
                justify-content: space-between;
                margin-bottom: 10px;
            }
            .element-actions button {
                margin-left: 5px;
                cursor: pointer;
            }

            .nested-container {
                margin-top: 10px;
                padding: 10px;
                border: 2px dashed #eee;
                min-height: 50px;
            }

            .properties {
                width: 280px;
                background: #fff;
                padding: 15px;
                border-radius: 8px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            }
            .property-group label {
                display: block;
                margin: 5px 0;
            }
            .property-group input,
            select {
                width: 100%;
                padding: 6px;
                margin-bottom: 10px;
            }

            .preview {
                margin-top: 20px;
            }
            #previewCode {
                width: 100%;
                height: 150px;
                background: #f8f8f8;
                border: 1px solid #ddd;
                padding: 10px;
                overflow: auto;
            }

            .actions {
                margin-top: 15px;
                display: flex;
                gap: 10px;
                justify-content: center;
            }

            button {
                padding: 8px 14px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }

            .btn-primary {
                background: #007bff;
                color: #fff;
            }
            .btn-secondary {
                background: #6c757d;
                color: #fff;
            }

            .empty-message {
                text-align: center;
                color: #666;
                padding: 40px 0;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <div class="sidebar">
                <h3>Elements</h3>
                <div class="element" draggable="true" data-type="text">
                    Text
                </div>
                <div class="element" draggable="true" data-type="email">
                    Email
                </div>
                <div class="element" draggable="true" data-type="number">
                    Number
                </div>
                <div class="element" draggable="true" data-type="textarea">
                    Textarea
                </div>
                <div class="element" draggable="true" data-type="checkbox">
                    Checkbox
                </div>
                <div class="element" draggable="true" data-type="select">
                    Dropdown
                </div>
                <div class="element" draggable="true" data-type="button">
                    Button
                </div>
                <div class="element" draggable="true" data-type="section">
                    Section
                </div>
            </div>

            <div class="canvas">
                <h3>Canvas</h3>
                <div id="formCanvas">
                    <div class="empty-message">Drag elements here</div>
                </div>

                <div class="preview">
                    <h3>Generated HTML</h3>
                    <pre id="previewCode"></pre>
                </div>

                <div class="actions">
                    <button class="btn-secondary" id="previewBtn">
                        Preview
                    </button>
                    <button class="btn-primary" id="exportBtn">Export</button>
                    <button class="btn-secondary" id="resetBtn">Reset</button>
                </div>
            </div>

            <div class="properties">
                <h3>Properties</h3>
                <div id="propertiesContent">
                    <div class="empty-message">Select an element</div>
                </div>
            </div>
        </div>

        <script>
            const formElements = [];
            let selectedElement = null;
            let counter = 0;

            const canvas = document.getElementById("formCanvas");
            const props = document.getElementById("propertiesContent");
            const preview = document.getElementById("previewCode");

            document.querySelectorAll(".element").forEach((el) => {
                el.addEventListener("dragstart", (e) => {
                    e.dataTransfer.setData("type", el.dataset.type);
                });
            });

            canvas.addEventListener("dragover", (e) => {
                e.preventDefault();
                canvas.classList.add("drag-over");
            });

            canvas.addEventListener("dragleave", () =>
                canvas.classList.remove("drag-over"),
            );

            canvas.addEventListener("drop", (e) => {
                e.preventDefault();
                canvas.classList.remove("drag-over");
                addElement(e.dataTransfer.getData("type"));
            });

            function addElement(type, parentId = null) {
                counter++;

                const data = {
                    id: "el-" + counter,
                    type,
                    label: type,
                    placeholder: "",
                    required: false,
                    options: type === "select" ? ["Option 1", "Option 2"] : [],
                    children: [],
                };

                if (!parentId) formElements.push(data);

                const div = document.createElement("div");
                div.className = "form-element";
                div.id = data.id;

                div.innerHTML = `
    <div class="element-header">
      <strong>${data.label}</strong>
      <div class="element-actions">
        <button onclick="selectElement('${data.id}')">Edit</button>
        <button onclick="deleteElement('${data.id}')">Delete</button>
      </div>
    </div>
    <div class="element-content">${renderHTML(data)}</div>
    ${type === "section" ? '<div class="nested-container"></div>' : ""}
  `;

                div.onclick = (e) => {
                    e.stopPropagation();
                    selectElement(data.id);
                };

                if (parentId) {
                    const parent = document.getElementById(parentId);
                    parent.querySelector(".nested-container").appendChild(div);
                    const parentData = findElement(parentId);
                    parentData.children.push(data);
                } else {
                    const empty = canvas.querySelector(".empty-message");
                    if (empty) empty.remove();
                    canvas.appendChild(div);
                }

                if (type === "section")
                    setupNested(div.querySelector(".nested-container"));

                updatePreview();
            }

            function setupNested(container) {
                container.addEventListener("dragover", (e) =>
                    e.preventDefault(),
                );
                container.addEventListener("drop", (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const parentId = container.closest(".form-element").id;
                    addElement(e.dataTransfer.getData("type"), parentId);
                });
            }

            function selectElement(id) {
                document
                    .querySelectorAll(".form-element")
                    .forEach((el) => el.classList.remove("selected"));

                const el = document.getElementById(id);
                el.classList.add("selected");
                selectedElement = id;

                showProperties(findElement(id));
            }

            function showProperties(data) {
                props.innerHTML = `
    <div class="property-group">
      <label>Label</label>
      <input value="${data.label}" onchange="updateProp('${data.id}','label',this.value)">

      <label>Placeholder</label>
      <input value="${data.placeholder}" onchange="updateProp('${data.id}','placeholder',this.value)">

      <label>
        <input type="checkbox" ${data.required ? "checked" : ""}
        onchange="updateProp('${data.id}','required',this.checked)"> Required
      </label>
    </div>
  `;
            }

            function updateProp(id, prop, val) {
                const data = findElement(id);
                data[prop] = val;

                const el = document.getElementById(id);
                el.querySelector(".element-content").innerHTML =
                    renderHTML(data);
                el.querySelector("strong").textContent = data.label;

                updatePreview();
            }

            function deleteElement(id) {
                removeData(id, formElements);

                const el = document.getElementById(id);
                if (el) el.remove();

                selectedElement = null;
                props.innerHTML =
                    '<div class="empty-message">Select an element</div>';

                if (!canvas.querySelector(".form-element")) {
                    canvas.innerHTML =
                        '<div class="empty-message">Drag elements here</div>';
                }

                updatePreview();
            }

            function removeData(id, list) {
                for (let i = 0; i < list.length; i++) {
                    if (list[i].id === id) return list.splice(i, 1);
                    removeData(id, list[i].children);
                }
            }

            function findElement(id, list = formElements) {
                for (const el of list) {
                    if (el.id === id) return el;
                    const found = findElement(id, el.children);
                    if (found) return found;
                }
            }

            function renderHTML(d) {
                const req = d.required ? "required" : "";
                switch (d.type) {
                    case "text":
                    case "email":
                    case "number":
                        return `<label>${d.label}</label><input type="${d.type}" placeholder="${d.placeholder}" ${req}>`;
                    case "textarea":
                        return `<label>${d.label}</label><textarea placeholder="${d.placeholder}" ${req}></textarea>`;
                    case "checkbox":
                        return `<label><input type="checkbox" ${req}> ${d.label}</label>`;
                    case "select":
                        return `<label>${d.label}</label><select>${d.options.map((o) => `<option>${o}</option>`).join("")}</select>`;
                    case "button":
                        return `<button>${d.label}</button>`;
                    case "section":
                        return `<strong>${d.label}</strong>`;
                }
            }

            function buildHTML(el) {
                if (el.type === "section") {
                    return `<fieldset><legend>${el.label}</legend>${el.children.map(buildHTML).join("")}</fieldset>`;
                }
                return renderHTML(el);
            }

            function updatePreview() {
                preview.textContent =
                    "<form>\n" +
                    formElements.map(buildHTML).join("\n") +
                    "\n</form>";
            }

            document.getElementById("exportBtn").onclick = () => {
                navigator.clipboard.writeText(preview.textContent);
                alert("HTML copied!");
            };

            document.getElementById("resetBtn").onclick = () => {
                formElements.length = 0;
                canvas.innerHTML =
                    '<div class="empty-message">Drag elements here</div>';
                props.innerHTML =
                    '<div class="empty-message">Select an element</div>';
                updatePreview();
            };
        </script>
    </body>
</html>
